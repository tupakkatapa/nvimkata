id = "free_074"
version = "1.0.0"
title = "REST API Overhaul"
topic = "grand"
difficulty = 4
hint = "Change route prefixes, rename handlers, update HTTP methods, restructure request/response objects, add validation"

[start]
content = """
const express = require("express");
const router = express.Router();
const db = require("./db");

router.get("/api/users", function(req, res) {
  const users = db.getAllUsers();
  res.json(users);
});

router.get("/api/users/:id", function(req, res) {
  const user = db.getUserById(req.params.id);
  if (!user) {
    res.status(404).json({ message: "not found" });
    return;
  }
  res.json(user);
});

router.post("/api/users", function(req, res) {
  const name = req.body.name;
  const email = req.body.email;
  const newUser = db.createUser({ name, email });
  res.status(200).json(newUser);
});

router.put("/api/users/:id", function(req, res) {
  const name = req.body.name;
  const email = req.body.email;
  const updated = db.updateUser(req.params.id, { name, email });
  if (!updated) {
    res.status(404).json({ message: "not found" });
    return;
  }
  res.json(updated);
});

router.delete("/api/users/:id", function(req, res) {
  const deleted = db.deleteUser(req.params.id);
  if (!deleted) {
    res.status(404).json({ message: "not found" });
    return;
  }
  res.json({ message: "deleted" });
});

module.exports = router;
"""

[target]
content = """
const express = require("express");
const router = express.Router();
const db = require("./db");

router.get("/api/v2/accounts", async (req, res) => {
  const accounts = await db.getAllAccounts();
  res.json({ data: accounts, status: "ok" });
});

router.get("/api/v2/accounts/:id", async (req, res) => {
  const account = await db.getAccountById(req.params.id);
  if (!account) {
    res.status(404).json({ error: "Account not found", status: "error" });
    return;
  }
  res.json({ data: account, status: "ok" });
});

router.post("/api/v2/accounts", async (req, res) => {
  const { name, email } = req.body;
  if (!name || !email) {
    res.status(400).json({ error: "Name and email required", status: "error" });
    return;
  }
  const newAccount = await db.createAccount({ name, email });
  res.status(201).json({ data: newAccount, status: "ok" });
});

router.patch("/api/v2/accounts/:id", async (req, res) => {
  const { name, email } = req.body;
  if (!name && !email) {
    res.status(400).json({ error: "At least one field required", status: "error" });
    return;
  }
  const updated = await db.updateAccount(req.params.id, { name, email });
  if (!updated) {
    res.status(404).json({ error: "Account not found", status: "error" });
    return;
  }
  res.json({ data: updated, status: "ok" });
});

router.delete("/api/v2/accounts/:id", async (req, res) => {
  const deleted = await db.deleteAccount(req.params.id);
  if (!deleted) {
    res.status(404).json({ error: "Account not found", status: "error" });
    return;
  }
  res.status(204).send();
});

module.exports = router;
"""
